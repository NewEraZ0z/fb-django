<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
</head>
<body>
    <div id="left-panel">
        <!-- Left panel content: List of connected pages -->
    </div>
    <div id="middle-panel">
        <!-- Middle panel content: List of users for the selected page -->
    </div>
    <div id="right-panel">
        <!-- Right panel content: Conversation with the selected user -->
        <div id="chat-widget">
            <div id="messages"></div>
            <input type="text" id="message-input" placeholder="Type your message here...">
            <button id="send-button">Send</button>
        </div>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function() {
            const sendButton = document.getElementById("send-button");
            const messageInput = document.getElementById("message-input");
            const messagesDiv = document.getElementById("messages");

            if (sendButton && messageInput && messagesDiv) {
                sendButton.onclick = function() {
                    const messageText = messageInput.value;
                    if (messageText.trim()) {
                        // Display the message in the chat widget
                        const messageElement = document.createElement("div");
                        messageElement.textContent = messageText;
                        messagesDiv.appendChild(messageElement);

                        // Clear the input field
                        messageInput.value = "";

                        // Send the message to the server (example using fetch)
                        fetch('/send_message/', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                                'X-CSRFToken': getCookie('csrftoken')
                            },
                            body: JSON.stringify({ message: messageText })
                        }).then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        }).then(data => {
                            console.log('Message sent successfully:', data);
                        }).catch(error => {
                            console.error('Error sending message:', error);
                        });
                    }
                };
            } else {
                console.error("One or more elements not found in the DOM.");
            }

            // Function to get CSRF token from cookie
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                    const cookies = document.cookie.split(';');
                    for (let i = 0; i < cookies.length; i++) {
                        const cookie = cookies[i].trim();
                        if (cookie.substring(0, name.length + 1) === (name + '=')) {
                            cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                            break;
                        }
                    }
                }
                return cookieValue;
            }
        });
    </script>
</body>
</html>
